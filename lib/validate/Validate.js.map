{"version":3,"sources":["../../dev/mtui/validate/Validate.jsx"],"names":["Validate","props","state","type","info","onChange","onFocus","onBlur","lockChange","suffix","setState","arr","obj","i","length","reslt","val","exgs","exg","regs","regx","RegExp","test","push","arrlen","arrValLen","setInfo","setIcon","e","target","localName","validate","value","on","dom","findDOMNode","refs","input","children","onBlurDo","bind","nextProps","nextState","off","self","cName","className","other","child","Children","only","join","ref","changeVal","onFocusDo","validateInfo","cloneElement","defaultProps","size","ValidateGroup","refForm","preventDefault","elems","elements","trigger","setTimeout","danger","getElementsByClassName","warning","submit","c","submitEvent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;IAEMA,Q;;;AAMF;AACA,sBAAYC,KAAZ,EAAmB;AAAA;;AAAA,8IACTA,KADS;;AAEf,cAAKC,KAAL,GAAa;AACTC,kBAAM,QADG,EACQ;AACjBC,kBAAM;AAFG,SAAb;AAIA,cAAKC,QAAL,GAAgB,IAAhB;AACA,cAAKC,OAAL,GAAe,IAAf,CAPe,CAOM;AACrB,cAAKC,MAAL,GAAc,IAAd,CARe,CAQK;AACpB,cAAKC,UAAL,GAAkB,IAAlB,CATe,CASS;AATT;AAUlB;;AAED;;;;;kCACU;AACN,gBAAIC,eAAJ;AACA,gBAAI,KAAKP,KAAL,CAAWC,IAAX,KAAoB,QAAxB,EAAkC;AAC9BM,yBAAS,qCAAG,WAAU,oBAAb,GAAT;AACH,aAFD,MAEO;AACHA,yBAAS,qCAAG,WAAW,mBAAmB,KAAKP,KAAL,CAAWC,IAA5C,GAAT;AACH;;AAED,iBAAKO,QAAL,CAAc;AACVD,wBAAQA;AADE,aAAd;AAGH;;AAED;;;;kCACUE,G,EAAK;AACX,gBAAIC,MAAM,EAAV;AACA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,IAAIG,MAAxB,EAAgCD,GAAhC,EAAqC;AACjC,oBAAI,CAACD,IAAID,IAAIE,CAAJ,EAAO,OAAP,CAAJ,CAAL,EAA2B;AACvBD,wBAAID,IAAIE,CAAJ,EAAO,OAAP,CAAJ,IAAuB,CAAvB;AACH,iBAFD,MAEO;AACHD,wBAAID,IAAIE,CAAJ,EAAO,OAAP,CAAJ;AACH;AACJ;AACD,mBAAOD,GAAP;AACH;;AAED;;;;gCACQD,G,EAAKR,I,EAAM;AACf,gBAAIC,OAAO,EAAX;AACA,iBAAK,IAAIS,IAAI,CAAb,EAAgBA,IAAIF,IAAIG,MAAxB,EAAgCD,GAAhC,EAAqC;AACjC,oBAAIF,IAAIE,CAAJ,EAAOE,KAAP,KAAiBZ,IAArB,EAA2B;AACvBC,2BAAOO,IAAIE,CAAJ,EAAOT,IAAd;AACA;AACH;AACJ;AACD,mBAAOA,IAAP;AACH;;AAED;;;;iCACSY,G,EAAK;AACV;AACA,gBAAIC,OAAO,KAAKhB,KAAL,CAAWgB,IAAX,IAAmB,EAA9B;AACA,gBAAIN,MAAM,EAAV;AACA,iBAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAII,KAAKH,MAAzB,EAAiCD,GAAjC,EAAsC;AAClC,oBAAIK,YAAJ;AAAA,oBAASd,cAAT;AAAA,oBAAeD,cAAf;AAAA,oBAAqBY,cAArB;;AAEA,oBAAIE,KAAKJ,CAAL,EAAQM,IAAZ,EAAkB;AACdD,0BAAM,gBAAMD,KAAKJ,CAAL,EAAQM,IAAd,CAAN;AACH,iBAFD,MAEO;AACHD,0BAAMD,KAAKJ,CAAL,EAAQO,IAAd;AACH;AACDhB,wBAAOa,KAAKJ,CAAL,EAAQT,IAAf;AACAD,wBAAOc,KAAKJ,CAAL,EAAQV,IAAf;AACA,oBAAI,IAAIkB,MAAJ,CAAWH,GAAX,EAAgBI,IAAhB,CAAqBN,GAArB,CAAJ,EAA+B;AAC3BD,4BAAQ,SAAR;AACH,iBAFD,MAEO;AACHA,4BAAQZ,KAAR;AACH;AACDQ,oBAAIY,IAAJ,CAAS;AACLpB,0BAAMA,KADD;AAELC,0BAAMA,KAFD;AAGLW,2BAAOA;AAHF,iBAAT;AAKH;;AAED;AACA,gBAAIZ,OAAO,QAAX;AACA,gBAAIqB,SAAS,KAAKC,SAAL,CAAed,GAAf,CAAb;AACAa,qBAASA,UAAU,CAAnB;;AAEA,gBAAIA,OAAO,SAAP,MAAsBP,KAAKH,MAA/B,EAAuC;AACnCX,uBAAO,SAAP;AACH,aAFD,MAEO;AACH,oBAAIqB,OAAO,SAAP,KAAqB,MAAM,CAAN,IAAWA,OAAO,SAAP,CAAhC,IAAqD,KAAKA,OAAO,QAAP,CAA1D,IAA8E,CAAlF,EAAqF;AACjFrB,2BAAO,SAAP;AACH,iBAFD,MAEO;AACHA,2BAAO,QAAP;AACH;AACJ;AACD,gBAAIC,OAAO,KAAKsB,OAAL,CAAaf,GAAb,EAAkBR,IAAlB,CAAX;;AAEA,iBAAKO,QAAL,CAAc;AACVP,sBAAMA,IADI;AAEVC,sBAAMD,SAAS,SAAT,GAAqB,EAArB,GAA0BC;AAFtB,aAAd,EAGG,YAAY;AACX,qBAAKuB,OAAL;AACH,aALD;AAMH;;;kCAESC,C,EAAG;;AAET,gBAAI,KAAKvB,QAAT,EAAmB;AACf,qBAAKA,QAAL,CAAcuB,CAAd;AACH;;AAED,gBAAI,CAAC,KAAKpB,UAAN,IAAoBoB,EAAEC,MAAF,CAASC,SAAT,KAAuB,KAA/C,EAAsD;AAClD,qBAAKC,QAAL,CAAcH,EAAEC,MAAF,CAASG,KAAvB;AACH;AACJ;;;kCAESJ,C,EAAG;AACT,gBAAI,KAAKtB,OAAT,EAAkB;AACd,qBAAKA,OAAL,CAAasB,CAAb;AACH;AACJ;;;iCAEQA,C,EAAG;;AAER,gBAAI,KAAKrB,MAAT,EAAiB;AACb,qBAAKA,MAAL,CAAYqB,CAAZ;AACH;;AAED,gBAAI,KAAKpB,UAAT,EAAqB;AACjB,qBAAKA,UAAL,GAAkB,KAAlB;AACA,qBAAKuB,QAAL,CAAcH,EAAEC,MAAF,CAASG,KAAvB;AACH;AACJ;;;4CAEmB;AAChB,iBAAKL,OAAL;AACA,iCAAWM,EAAX,CAAc,aAAd,EAA6B,YAAY;AACrC,oBAAIC,MAAM,mBAASC,WAAT,CAAqB,KAAKC,IAAL,CAAUC,KAA/B,CAAV;AACA,qBAAK,IAAIxB,IAAI,CAAb,EAAgBA,IAAIqB,IAAII,QAAJ,CAAaxB,MAAjC,EAAyCD,GAAzC,EAA8C;AAC1C,wBAAIqB,IAAII,QAAJ,CAAazB,CAAb,EAAgBiB,SAAhB,KAA8B,OAAlC,EAA2C;AACvCI,8BAAMA,IAAII,QAAJ,CAAazB,CAAb,CAAN;AACA;AACH;AACJ;AACD,qBAAK0B,QAAL,CAAc;AACVV,4BAAQK,GADE;AAEVF,2BAAOE,IAAIF;AAFD,iBAAd;AAIH,aAZ4B,CAY3BQ,IAZ2B,CAYtB,IAZsB,CAA7B;AAaH;;;6CAEoB;AACjB;AACA,gBAAI,KAAKvC,KAAL,CAAWE,IAAf,EAAqB;AACjB,qBAAKO,QAAL,CAAc;AACVP,0BAAM,KAAKF,KAAL,CAAWE;AADP,iBAAd;AAGH;AACJ;;;4CAEmBsC,S,EAAWC,S,EAAW;AACtC,gBAAID,UAAUtC,IAAV,KAAmB,KAAKF,KAAL,CAAWE,IAAlC,EAAwC;AACpC,qBAAKO,QAAL,CAAc;AACVP,0BAAMsC,UAAUtC;AADN,iBAAd;AAGH;AACJ;;;+CAEsB;AACnB,iCAAWwC,GAAX,CAAe,aAAf;AACH;;;iCAEQ;;AAEL,gBAAIC,OAAO,IAAX;AACA,gBAAIC,QAAQ,CAAC,aAAD,CAAZ;AAHK,yBAIyC,KAAK5C,KAJ9C;AAAA,gBAIC6C,SAJD,UAICA,SAJD;AAAA,gBAIYR,QAJZ,UAIYA,QAJZ;AAAA,gBAIsBrB,IAJtB,UAIsBA,IAJtB;AAAA,gBAI+B8B,KAJ/B;;AAKL,gBAAIC,QAAQ,gBAAMC,QAAN,CAAeC,IAAf,CAAoBZ,QAApB,CAAZ;AACA,gBAAIQ,SAAJ,EAAe;AACXD,sBAAMtB,IAAN,CAAWuB,SAAX;AACH;;AAED,gBAAI,KAAK5C,KAAL,CAAWC,IAAf,EAAqB;AACjB0C,sBAAMtB,IAAN,CAAW,iBAAiB,KAAKrB,KAAL,CAAWC,IAAvC;AACH;;AAED;AACA,gBAAI,CAAC,KAAKE,QAAN,IAAkBiC,SAASrC,KAAT,CAAeI,QAArC,EAA+C;AAC3C,qBAAKA,QAAL,GAAgBiC,SAASrC,KAAT,CAAeI,QAAf,CAAwBmC,IAAxB,CAA6BF,QAA7B,CAAhB;AACH;AACD;AACA,gBAAI,CAAC,KAAKhC,OAAN,IAAiBgC,SAASrC,KAAT,CAAeK,OAApC,EAA6C;AACzC,qBAAKA,OAAL,GAAegC,SAASrC,KAAT,CAAeK,OAAf,CAAuBkC,IAAvB,CAA4BF,QAA5B,CAAf;AACH;AACD,gBAAI,CAAC,KAAK/B,MAAN,IAAgB+B,SAASrC,KAAT,CAAeM,MAAnC,EAA2C;AACvC,qBAAKA,MAAL,GAAc+B,SAASrC,KAAT,CAAeM,MAAf,CAAsBiC,IAAtB,CAA2BF,QAA3B,CAAd;AACH;;AAED,gBAAIrC,QAAQ,sBAAO,CAAC;AAChB6C,2BAAWD,MAAMM,IAAN,CAAW,GAAX,CADK;AAEhBC,qBAAK,OAFW;AAGhB3C,wBAAQmC,KAAK1C,KAAL,CAAWO,MAHH;AAIhBJ,0BAAUuC,KAAKS,SAAL,CAAeb,IAAf,CAAoBI,IAApB,CAJM;AAKhBtC,yBAASsC,KAAKU,SAAL,CAAed,IAAf,CAAoBI,IAApB,CALO;AAMhBrC,wBAAQqC,KAAKL,QAAL,CAAcC,IAAd,CAAmBI,IAAnB,CANQ;AAOhBW,8BAAcX,KAAK1C,KAAL,CAAWE,IAAX,GAAkB;AAAA;AAAA,sBAAM,WAAU,kBAAhB;AAAoCwC,yBAAK1C,KAAL,CAAWE;AAA/C,iBAAlB,GAAgF;AAP9E,aAAD,6BAQX2C,KARW,EAAP,CAAZ;AASA,mBAAO,gBAAMS,YAAN,CAAmBR,KAAnB,EAA0B/C,KAA1B,CAAP;AACH;;;;;AAGL;;;AAvNMD,Q,CAEKyD,Y,GAAe;AAClBC,UAAM,EADY,CACT;AADS,C;;IAsNpBC,a;;;AAEF,2BAAY1D,KAAZ,EAAmB;AAAA;;AAAA,yJACTA,KADS;;AAEf,eAAK2D,OAAL,GAAe,IAAf;AAFe;AAGlB;;;;oCAEWhC,C,EAAG;AACXA,cAAEiC,cAAF;AACA,gBAAIC,QAAQ,KAAKF,OAAL,CAAaG,QAAzB;;AAEA,iBAAK,IAAIlD,IAAI,CAAb,EAAgBA,IAAIiD,MAAMhD,MAA1B,EAAkCD,GAAlC,EAAuC;AACnC,oBAAIiD,MAAMjD,CAAN,EAASiB,SAAT,KAAuB,OAA3B,EAAoC;AAChC,yCAAWkC,OAAX,CAAmB,aAAnB;AACH;AACJ;;AAED;AACAC,uBAAW,YAAY;AACnB,oBAAIrD,MAAM;AACNsD,4BAAQ,KAAKN,OAAL,CAAaO,sBAAb,CAAoC,oBAApC,EAA0DrD,MAD5D;AAENsD,6BAAS,KAAKR,OAAL,CAAaO,sBAAb,CAAoC,qBAApC,EAA2DrD;AAF9D,iBAAV;;AAKA,oBAAIF,IAAIsD,MAAJ,GAAatD,IAAIwD,OAAjB,KAA6B,CAAjC,EAAoC;AAChCxD,wBAAI,SAAJ,IAAiB,IAAjB;AACH,iBAFD,MAEO;AACHA,wBAAI,SAAJ,IAAiB,KAAjB;AACH;;AAED,oBAAI,KAAKX,KAAL,CAAWoE,MAAf,EAAuB;AACnB,yBAAKpE,KAAL,CAAWoE,MAAX,CAAkBzD,GAAlB;AACH;AAEJ,aAhBU,CAgBT4B,IAhBS,CAgBJ,IAhBI,CAAX,EAgBc,CAhBd;AAkBH;;;iCAEQ;AAAA;;AAAA,0BACgC,KAAKvC,KADrC;AAAA,gBACCqC,QADD,WACCA,QADD;AAAA,gBACW+B,MADX,WACWA,MADX;AAAA,gBACsBtB,KADtB;;AAEL,mBAAO;AAAA;AAAA,yCAAM,KAAK,aAACuB,CAAD,EAAO;AAAE,+BAAKV,OAAL,GAAeU,CAAf;AAAmB,qBAAvC,EAAyC,UAAU,KAAKC,WAAL,CAAiB/B,IAAjB,CAAsB,IAAtB,CAAnD,IAAoFO,KAApF;AAA4FT;AAA5F,aAAP;AACH;;;;;AAGLtC,SAAS2D,aAAT,GAAyBA,aAAzB;;AAEA;eACe3D,Q;;;;;;;;;kCAvQTA,Q;;kCAwNA2D,a","file":"Validate.js","sourcesContent":["\r\nimport React, { Component } from 'react';\r\nimport regex from './regex';\r\nimport eventProxy from '../utils/eventProxy';\r\nimport ReactDOM from 'react-dom';\r\nimport assign from '../utils/assign';\r\n\r\nclass Validate extends Component {\r\n\r\n    static defaultProps = {\r\n        size: '' // 默认,  min\r\n    }\r\n\r\n    // 构造函数\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            type: 'nomarl',  // 验证错误的类型\r\n            info: ''\r\n        };\r\n        this.onChange = null;\r\n        this.onFocus = null; // 获取焦点\r\n        this.onBlur = null; // 失去焦点\r\n        this.lockChange = true; // 监听 onChange的 锁\r\n    }\r\n\r\n    // 设置icon\r\n    setIcon() {\r\n        let suffix;\r\n        if (this.state.type === 'nomarl') {\r\n            suffix = <i className=\"iconfont icon-null\"></i>;\r\n        } else {\r\n            suffix = <i className={'iconfont icon-' + this.state.type}></i>;\r\n        }\r\n\r\n        this.setState({\r\n            suffix: suffix\r\n        });\r\n    }\r\n\r\n    // 获取数组中，对应的长度\r\n    arrValLen(arr) {\r\n        let obj = {};\r\n        for (let i = 0; i < arr.length; i++) {\r\n            if (!obj[arr[i]['reslt']]) {\r\n                obj[arr[i]['reslt']] = 1;\r\n            } else {\r\n                obj[arr[i]['reslt']]++;\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    // 通过arr 和 type 设置 info\r\n    setInfo(arr, type) {\r\n        let info = '';\r\n        for (let i = 0; i < arr.length; i++) {\r\n            if (arr[i].reslt === type) {\r\n                info = arr[i].info;\r\n                break;\r\n            }\r\n        }\r\n        return info;\r\n    }\r\n\r\n    // 数据验证\r\n    validate(val) {\r\n        // console.log(this.props.exgs)\r\n        let exgs = this.props.exgs || [];\r\n        let arr = [];\r\n        for (let i = 0; i < exgs.length; i++) {\r\n            let exg, info, type, reslt;\r\n\r\n            if (exgs[i].regs) {\r\n                exg = regex[exgs[i].regs];\r\n            } else {\r\n                exg = exgs[i].regx;\r\n            }\r\n            info = exgs[i].info;\r\n            type = exgs[i].type;\r\n            if (new RegExp(exg).test(val)) {\r\n                reslt = 'success';\r\n            } else {\r\n                reslt = type;\r\n            }\r\n            arr.push({\r\n                type: type,\r\n                info: info,\r\n                reslt: reslt\r\n            });\r\n        }\r\n\r\n        // 因为 type 和 info 有多个。这里danger优先显示原则进行显示\r\n        let type = 'normal';\r\n        let arrlen = this.arrValLen(arr);\r\n        arrlen = arrlen || 0;\r\n\r\n        if (arrlen['success'] === exgs.length) {\r\n            type = 'success';\r\n        } else {\r\n            if (arrlen['warning'] || 0 !== 0 && arrlen['warning'] || 0 >= arrlen['danger'] || 0) {\r\n                type = 'warning';\r\n            } else {\r\n                type = 'danger';\r\n            }\r\n        }\r\n        let info = this.setInfo(arr, type);\r\n\r\n        this.setState({\r\n            type: type,\r\n            info: type === 'success' ? '' : info\r\n        }, function () {\r\n            this.setIcon();\r\n        });\r\n    }\r\n\r\n    changeVal(e) {\r\n\r\n        if (this.onChange) {\r\n            this.onChange(e);\r\n        }\r\n\r\n        if (!this.lockChange || e.target.localName === 'div') {\r\n            this.validate(e.target.value);\r\n        }\r\n    }\r\n\r\n    onFocusDo(e) {\r\n        if (this.onFocus) {\r\n            this.onFocus(e);\r\n        }\r\n    }\r\n\r\n    onBlurDo(e) {\r\n\r\n        if (this.onBlur) {\r\n            this.onBlur(e);\r\n        }\r\n\r\n        if (this.lockChange) {\r\n            this.lockChange = false;\r\n            this.validate(e.target.value);\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.setIcon();\r\n        eventProxy.on('mt-validate', function () {\r\n            let dom = ReactDOM.findDOMNode(this.refs.input);\r\n            for (let i = 0; i < dom.children.length; i++) {\r\n                if (dom.children[i].localName === 'input') {\r\n                    dom = dom.children[i];\r\n                    break;\r\n                }\r\n            }\r\n            this.onBlurDo({\r\n                target: dom,\r\n                value: dom.value\r\n            });\r\n        }.bind(this));\r\n    }\r\n\r\n    componentWillMount() {\r\n        // 受控的验证表单，如果type 存在\r\n        if (this.props.type) {\r\n            this.setState({\r\n                type: this.props.type\r\n            });\r\n        }\r\n    }\r\n\r\n    componentWillUpdate(nextProps, nextState) {\r\n        if (nextProps.type !== this.props.type) {\r\n            this.setState({\r\n                type: nextProps.type\r\n            });\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        eventProxy.off('mt-validate');\r\n    }\r\n\r\n    render() {\r\n\r\n        let self = this;\r\n        let cName = ['mt-validate'];\r\n        let { className, children, exgs, ...other } = this.props;\r\n        let child = React.Children.only(children);\r\n        if (className) {\r\n            cName.push(className);\r\n        }\r\n\r\n        if (this.state.type) {\r\n            cName.push('mt-validate-' + this.state.type);\r\n        }\r\n\r\n        // 保留input 的 onChange\r\n        if (!this.onChange && children.props.onChange) {\r\n            this.onChange = children.props.onChange.bind(children);\r\n        }\r\n        // 保留this.onFocus this.onBlur\r\n        if (!this.onFocus && children.props.onFocus) {\r\n            this.onFocus = children.props.onFocus.bind(children);\r\n        }\r\n        if (!this.onBlur && children.props.onBlur) {\r\n            this.onBlur = children.props.onBlur.bind(children);\r\n        }\r\n\r\n        let props = assign([{\r\n            className: cName.join(' '),\r\n            ref: 'input',\r\n            suffix: self.state.suffix,\r\n            onChange: self.changeVal.bind(self),\r\n            onFocus: self.onFocusDo.bind(self),\r\n            onBlur: self.onBlurDo.bind(self),\r\n            validateInfo: self.state.info ? <span className=\"mt-validate-info\">{self.state.info}</span> : null\r\n        }, { ...other }]);\r\n        return React.cloneElement(child, props);\r\n    }\r\n}\r\n\r\n// 组\r\nclass ValidateGroup extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.refForm = null;\r\n    }\r\n\r\n    submitEvent(e) {\r\n        e.preventDefault();\r\n        let elems = this.refForm.elements;\r\n\r\n        for (let i = 0; i < elems.length; i++) {\r\n            if (elems[i].localName === 'input') {\r\n                eventProxy.trigger('mt-validate');\r\n            }\r\n        }\r\n\r\n        // 因为订阅的方法里面存在异步方法\r\n        setTimeout(function () {\r\n            let obj = {\r\n                danger: this.refForm.getElementsByClassName('mt-validate-danger').length,\r\n                warning: this.refForm.getElementsByClassName('mt-validate-warning').length\r\n            };\r\n\r\n            if (obj.danger + obj.warning === 0) {\r\n                obj['success'] = true;\r\n            } else {\r\n                obj['success'] = false;\r\n            }\r\n\r\n            if (this.props.submit) {\r\n                this.props.submit(obj);\r\n            }\r\n\r\n        }.bind(this), 1);\r\n\r\n    }\r\n\r\n    render() {\r\n        let { children, submit, ...other } = this.props;\r\n        return <form ref={(c) => { this.refForm = c; }} onSubmit={this.submitEvent.bind(this)} {...other}>{children}</form>;\r\n    }\r\n}\r\n\r\nValidate.ValidateGroup = ValidateGroup;\r\n\r\n// 主页\r\nexport default Validate;"]}