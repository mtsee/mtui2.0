{"version":3,"sources":["../../dev/mtui/dropdown/Dropdown.jsx"],"names":["DropDown","props","state","show","visible","div","document","createElement","setAttribute","handler","mid","refBtn","Date","mark","setMid","_this","dom","getElementById","body","appendChild","render","getPlace","bind","callback","self","renderDiv","setState","showBack","closeBack","hoverHandler","trigger","showOrHide","prevProps","e","addEventListener","removeEventListener","unmountComponentAtNode","Component","btn","type","children","className","other","cName","push","c","join","handleClick","defaultProps","style"],"mappings":"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","file":"Dropdown.js","sourcesContent":["\r\nimport React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom';\r\n// import { render } from 'react-dom';\r\nimport DropModal from './DropModal';\r\nimport { removeDom } from '../utils/dom';\r\nimport { position } from '../utils/offset';\r\nimport { clickBlank, offClickBlank } from '../utils/triggerBlank';\r\n\r\nclass DropDown extends Component {\r\n\r\n    // 默认参数\r\n    static defaultProps = {\r\n        btn: <a>dropdown</a>,\r\n        style: {},  // modal的样式\r\n        visible: false,  // 框默认隐藏\r\n        showBack: null,  // 显示时候的回调\r\n        closeBack: null,  // 关闭时候的回调\r\n        trigger: 'hover' // 触发下拉的行为\r\n    }\r\n\r\n    // 构造函数\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            show: props.visible\r\n        };\r\n        this.div = document.createElement('div');\r\n        this.div.setAttribute('class', 'mt-div');\r\n        this.handler = null;\r\n        this.mid = null;\r\n\r\n        this.refBtn = null;\r\n    }\r\n\r\n    // 设置 mid\r\n    setMid() {\r\n        if (this.mid === null) {\r\n            this.mid = 'mt_dropdown_' + +new Date();\r\n        }\r\n    }\r\n\r\n    getPlace() {\r\n        return position(this.refBtn);\r\n    }\r\n\r\n    // 渲染div\r\n    renderDiv(mark) {\r\n        this.setMid();\r\n        var _this = this;\r\n        var dom = document.getElementById(this.mid);\r\n        // 首次渲染即可\r\n        if (!dom || mark) {\r\n            if (!mark) {\r\n                document.body.appendChild(this.div);\r\n            }\r\n            // console.log(ReactDOM);\r\n            ReactDOM.render(<DropModal mid={this.mid} getPlace={this.getPlace.bind(this)} show={this.state.show} {...this.props} />, this.div);\r\n        }\r\n    }\r\n\r\n    // 隐藏显示\r\n    showOrHide(show, callback) {\r\n        var self = this;\r\n        this.renderDiv();\r\n        this.setState({\r\n            show: !show\r\n        }, function () {\r\n            if (self.state.show && self.props.showBack) {\r\n                self.props.showBack();\r\n            } else if (self.props.closeBack) {\r\n                self.props.closeBack();\r\n            }\r\n            if (callback) {\r\n                callback();\r\n            }\r\n        });\r\n        this.hoverHandler = null;\r\n    }\r\n\r\n    // 点击事件\r\n    handleClick() {\r\n        const self = this;\r\n        const show = this.state.show;\r\n        if (this.props.trigger === 'click') {\r\n            this.showOrHide(show, function () {\r\n                if (self.handler) {\r\n                    offClickBlank(self.handler);\r\n                }\r\n                self.handler = clickBlank(document.getElementById(self.mid), function (mark) {\r\n                    if (!mark) {\r\n                        self.showOrHide(true);\r\n                        offClickBlank(self.handler);\r\n                    }\r\n                });\r\n            });\r\n        } else {\r\n            return;\r\n        }\r\n    }\r\n\r\n    // 更新弹窗里面的数据\r\n    componentDidUpdate(prevProps) {\r\n        if (document.getElementById(this.mid)) {\r\n            this.renderDiv(true);\r\n        }\r\n    }\r\n\r\n    // 初始化状态\r\n    componentDidMount() {\r\n\r\n        // 如果默认是显示，直接显示DIV\r\n        if (this.props.visible) {\r\n            this.renderDiv();\r\n        }\r\n\r\n        // hover事件\r\n        if (this.props.trigger === 'hover') {\r\n            const self = this;\r\n\r\n            // hover 事件\r\n            this.hoverHandler = function (e) {\r\n                // 如果显示，不再继续显示\r\n                if (self.state.show) {\r\n                    return;\r\n                }\r\n                self.showOrHide(false, function () {\r\n                    if (self.handler) {\r\n                        offClickBlank(self.handler, 'mousemove');\r\n                    }\r\n                    // 点击其他区域，隐藏\r\n                    self.handler = clickBlank(document.getElementById(self.mid), function (mark) {\r\n                        if (!mark) {\r\n                            self.showOrHide(true, null);\r\n                            offClickBlank(self.handler, 'mousemove');\r\n                        }\r\n                    }, 'mousemove', self.refBtn);\r\n                });\r\n            };\r\n\r\n            // 绑定 hover\r\n            this.refBtn.addEventListener('mouseover', this.hoverHandler);\r\n        }\r\n    }\r\n\r\n    // 卸载组件\r\n    componentWillUnmount() {\r\n        if (this.props.trigger === 'hover') {\r\n            offClickBlank(this.handler, 'mousemove');\r\n            this.refBtn.removeEventListener('mouseover', this.hoverHandler);\r\n        } else {\r\n            offClickBlank(this.handler);\r\n        }\r\n        removeDom(this.div);\r\n        ReactDOM.unmountComponentAtNode(this.div);\r\n    }\r\n\r\n    render() {\r\n        var Component = this.props.btn.type;\r\n        var { children, className, ...other } = this.props.btn.props;\r\n        var cName = ['mt-dropdown-btn'];\r\n        if (className) {\r\n            cName.push(className);\r\n        }\r\n        return <Component ref={(c) => { this.refBtn = c; }} className={cName.join(' ')} onClick={this.handleClick.bind(this)} {...other}>{children}</Component>;\r\n    }\r\n}\r\n\r\n// 主页\r\nexport default DropDown;"]}