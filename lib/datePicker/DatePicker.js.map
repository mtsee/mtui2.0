{"version":3,"sources":["../../dev/mtui/datePicker/DatePicker.jsx"],"names":["DatePicker","props","dateToOBj","state","show","nowDate","clear","inputDate","div","document","createElement","setAttribute","handler","mid","refBtn","date","mark","setState","Date","self","dom","getElementById","body","appendChild","render","range","format","setPlace","bind","modalStyle","modalClass","resetDays","showOrHide","callback","data","e","box","renderDiv","showBack","onChange","obj","key","parseInt","str","replace","_btn","style","display","dateVal","val","split","year","month","day","visible","defaultValue","value","handleClick","prevProps","MT_MS","removeNode","remove","unmountComponentAtNode","nextProps","className","size","datePickers","suffix","validateInfo","other","cName","dayval","push","c","join","placeholder","defaultProps"],"mappings":"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","file":"DatePicker.js","sourcesContent":["'use strict';\r\nimport React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { getMDay, weekNumber, judgeDate, addAndDelOneMonth, getDateNow, formatDate, setHHMMSS, setDays, setMonths } from '../dateCore/dateCore';\r\nimport DatePickerBox from '../dateCore/DatePickerBox';\r\nimport { position } from '../utils/offset';\r\nimport { getXY, clickBlank, offClickBlank } from '../utils/triggerBlank';\r\n\r\nclass DatePicker extends Component {\r\n\r\n    // 默认参数\r\n    static defaultProps = {\r\n        placeholder: '日期',\r\n        showBack: null,  // 显示时候的回调\r\n        onChange: function () {\r\n            // ...\r\n        },  // 关闭时候的回调\r\n        modalClass: '',\r\n        modalStyle: {}, // \r\n        validateInfo: null,\r\n        format: 'yyyy-mm-dd' // 格式化\r\n    }\r\n\r\n    // 构造函数\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            show: false,\r\n            nowDate: null,\r\n            clear: false,\r\n            inputDate: null\r\n        };\r\n        this.div = document.createElement('div');\r\n        this.div.setAttribute('class', 'mt-div');\r\n        this.handler = null;\r\n        this.mid = null;\r\n        this.refBtn = null;\r\n    }\r\n\r\n    // 重新渲染\r\n    resetDays(date, mark) {\r\n        if (mark) {\r\n            this.setState({\r\n                nowDate: date,\r\n                inputDate: date\r\n            });\r\n        } else {\r\n            this.setState({\r\n                nowDate: date\r\n            });\r\n        }\r\n    }\r\n\r\n    setPlace() {\r\n        return position(this.refBtn);\r\n    }\r\n\r\n    // 渲染div mark == true 表示更新\r\n    renderDiv(mark) {\r\n\r\n        // 设置 mid\r\n        if (this.mid === null) {\r\n            this.mid = 'mt_date_' + +new Date();\r\n        }\r\n\r\n        var self = this;\r\n        var dom = document.getElementById(this.mid);\r\n        // 首次渲染即可\r\n        if (!dom || mark) {\r\n            if (!mark) {\r\n                document.body.appendChild(this.div);\r\n            }\r\n            ReactDOM.render(<DatePickerBox\r\n                nowDate={this.state.nowDate}\r\n                range={this.props.range}\r\n                format={this.props.format}\r\n                mid={this.mid}\r\n                setPlace={this.setPlace.bind(this)}\r\n                show={this.state.show}\r\n                modalStyle={this.props.modalStyle}\r\n                modalClass={this.props.modalClass}\r\n                resetDays={this.resetDays.bind(this)}\r\n                showOrHide={this.showOrHide.bind(this)} />, this.div); // \r\n        }\r\n    }\r\n\r\n    // 隐藏显示\r\n    showOrHide(show, callback, data, e) {\r\n        let box = document.getElementById(this.mid);\r\n\r\n        // 如果没有，初始化一个\r\n        if (!box) {\r\n            this.renderDiv();\r\n        }\r\n\r\n        this.setState({\r\n            show: !show\r\n        }, () => {\r\n            if (this.state.show) {\r\n                if (this.props.showBack) {\r\n                    this.props.showBack();\r\n                }\r\n            } else {\r\n                if (this.props.onChange && data && judgeDate(data.obj, this.props.range)) {\r\n                    this.setState({\r\n                        clear: data.clear\r\n                    });\r\n\r\n                    // 数据过滤\r\n                    for (let key in data.obj) {\r\n                        if (data.obj[key]) {\r\n                            data.obj[key] = parseInt(data.obj[key], 10);\r\n                        } else {\r\n                            delete data.obj[key];\r\n                        }\r\n                    }\r\n                    data.str = data.str.replace(/-NaN/g, '');\r\n                    data.str = data.str.replace(/-null/g, '');\r\n                    data.str = data.str.replace(/-undefined/g, '');\r\n\r\n                    // 在范围内修改才有效\r\n                    this.props.onChange(e, data);\r\n                }\r\n            }\r\n\r\n            // 修改input 里面的值\r\n            if (data && judgeDate(data.obj, this.props.range)) {\r\n                this.setState({\r\n                    inputDate: data.obj\r\n                });\r\n            }\r\n\r\n            if (callback) {\r\n                callback(data);\r\n            }\r\n        });\r\n    }\r\n\r\n    // 点击事件\r\n    handleClick(e) {\r\n        let _btn = document.getElementById(this.mid);\r\n        if (_btn && _btn.style.display === 'block') {\r\n            return;\r\n        }\r\n\r\n        const self = this;\r\n\r\n        this.showOrHide(self.state.show);\r\n        if (this.handler) {\r\n            offClickBlank(self.handler);\r\n        }\r\n        // 绑定点击空白事件\r\n        this.handler = clickBlank(\r\n            document.getElementById(self.mid),\r\n            function (mark) {\r\n                if (!mark) {\r\n                    self.showOrHide(true);\r\n                    offClickBlank(self.handler);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    // xxxx-xx-xx　转换成 obj\r\n    dateToOBj = (dateVal) => {\r\n        let date = null;\r\n        if (dateVal) {\r\n            let val = dateVal.split('-');\r\n            date = {\r\n                year: parseInt(val[0], 10) || null,\r\n                month: parseInt(val[1], 10) || null,\r\n                day: parseInt(val[2], 10) || null\r\n            };\r\n        } else {\r\n            date = getDateNow();\r\n            this.setState({\r\n                clear: true,\r\n                show: this.props.visible ? true : false\r\n            });\r\n        }\r\n\r\n        return date;\r\n    }\r\n\r\n    // 渲染前\r\n    componentWillMount() {\r\n        // 初始化日期 默认是当前日期\r\n        let dateVal = this.props.defaultValue || this.props.value;\r\n        this.resetDays(this.dateToOBj(dateVal), true);\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (this.props.visible) {\r\n            this.handleClick();\r\n        }\r\n    }\r\n\r\n    // 更新弹窗里面的数据\r\n    componentDidUpdate(prevProps) {\r\n        if(document.getElementById(this.mid)) {\r\n            this.renderDiv(true);\r\n        }\r\n    }\r\n\r\n    // 卸载组件\r\n    componentWillUnmount() {\r\n        offClickBlank(this.handler);\r\n        if(MT_MS === 'IE') {\r\n            this.div.removeNode(true);\r\n        }else{\r\n            this.div.remove();\r\n        }\r\n        ReactDOM.unmountComponentAtNode(this.div);\r\n    }\r\n\r\n    // 如果 value 更新\r\n    componentWillReceiveProps(nextProps) {\r\n        if (nextProps.value !== this.props.value) {\r\n            this.setState({\r\n                clear: nextProps.value ? false : true,\r\n                nowDate: this.dateToOBj(nextProps.value),\r\n                inputDate: this.dateToOBj(nextProps.value)\r\n            });\r\n        }\r\n    }\r\n\r\n    render() {\r\n        var { mid, format, showBack, range, modalClass, modalStyle, defaultValue, value, className, size, datePickers, visible, suffix, validateInfo, onChange, ...other } = this.props;\r\n        var cName = ['mt-input mt-input-date mt-input-suffix-out'];\r\n        var dayval = formatDate(this.state.inputDate, this.props.format).val;\r\n        if (className) {\r\n            cName.push(className);\r\n        }\r\n        cName.push('mt-input-' + (size ? size : 'nm'));\r\n        if (mid) {\r\n            this.mid = mid;\r\n        }\r\n        return <span ref={(c) => { this.refBtn = c; }} className={cName.join(' ')} onClick={this.handleClick.bind(this)}  >\r\n            <input\r\n                value={this.state.clear ? '' : dayval}\r\n                readOnly\r\n                type=\"text\"\r\n                placeholder={this.props.placeholder}\r\n                {...other} />\r\n            {validateInfo ? <span className=\"mt-input-suffix\">{suffix}</span> : <span className=\"mt-input-suffix\"><i className=\"iconfont icon-date\"></i></span>}\r\n            {validateInfo}\r\n        </span>;\r\n    }\r\n}\r\n\r\n// 主页\r\nexport default DatePicker;"]}